"use strict";(self.webpackChunkaupus_energia_react=self.webpackChunkaupus_energia_react||[]).push([[703],{703:(t,o,e)=>{e.r(o),e.d(o,{default:()=>n});class a{constructor(){this.jsPDFLoaded=!1}async loadJsPDF(){if(this.jsPDFLoaded&&window.jspdf)return!0;try{return window.jspdf||(console.log("\ud83d\udce5 Carregando jsPDF..."),await new Promise((t,o)=>{const e=document.createElement("script");e.src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js",e.onload=t,e.onerror=()=>o(new Error("Falha ao carregar jsPDF")),document.head.appendChild(e)})),this.jsPDFLoaded=!0,console.log("\u2705 jsPDF carregado com sucesso"),!0}catch(t){throw console.error("\u274c Erro ao carregar jsPDF:",t),new Error("N\xe3o foi poss\xedvel carregar o gerador de PDF")}}async comprimirPDF(t){try{console.log("\ud83d\udddc\ufe0f Iniciando compress\xe3o do PDF...");const e=t.output("arraybuffer").byteLength;if(console.log("\ud83d\udce6 Tamanho original: ".concat((e/1024).toFixed(2)," KB")),t.internal&&t.internal.deflate)try{t.internal.deflate=!0,console.log("\u2705 Compress\xe3o deflate ativada")}catch(o){console.warn("\u26a0\ufe0f Deflate n\xe3o dispon\xedvel:",o.message)}await this.otimizarImagensExistentes(t),this.otimizarFontes(t),this.removerMetadadosDesnecessarios(t);const a=t.output("arraybuffer").byteLength,n=e-a,r=(n/e*100).toFixed(1);return console.log("\ud83d\udce6 Tamanho comprimido: ".concat((a/1024).toFixed(2)," KB")),console.log("\ud83d\udcbe Economia: ".concat((n/1024).toFixed(2)," KB (").concat(r,"%)")),t}catch(e){return console.warn("\u26a0\ufe0f Erro na compress\xe3o (continuando com PDF original):",e),t}}async otimizarImagensExistentes(t){try{t.internal&&t.internal.pageSize&&(console.log("\ud83d\uddbc\ufe0f Otimizando imagens..."),t.internal.scaleFactor&&(t.internal.scaleFactor=Math.min(t.internal.scaleFactor,2)),t.setImageProperties&&(t.setImageProperties=function(t){t&&"object"===typeof t&&(t.compression="FAST",t.quality=.7)}))}catch(o){console.warn("\u26a0\ufe0f Erro ao otimizar imagens:",o)}}otimizarFontes(t){try{console.log("\ud83d\udd24 Otimizando fontes..."),t.internal&&t.internal.events&&t.internal.events.subscribe&&t.internal.events.subscribe("addFont",function(t){t&&t.metadata&&(delete t.metadata.description,delete t.metadata.version,delete t.metadata.trademark)})}catch(o){console.warn("\u26a0\ufe0f Erro ao otimizar fontes:",o)}}removerMetadadosDesnecessarios(t){try{console.log("\ud83e\uddf9 Removendo metadados desnecess\xe1rios..."),t.internal&&t.internal.events&&(t.setProperties({title:"Proposta Comercial",creator:"AUPUS",producer:"AUPUS PDF Generator"}),t.internal.annotations&&(t.internal.annotations=t.internal.annotations.filter(t=>"text"===t.type||"link"===t.type)))}catch(o){console.warn("\u26a0\ufe0f Erro ao remover metadados:",o)}}async gerarPDF(t){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{console.log("\ud83d\udcc4 Iniciando gera\xe7\xe3o de PDF...",t.numeroProposta),await this.loadJsPDF();const{jsPDF:e}=window.jspdf,a=new e({orientation:"p",unit:"mm",format:"a4",compress:!0,encryption:{userPassword:"",ownerPassword:"",userPermissions:[]}});await this.criarLayoutPDF(a,t);const n=await this.comprimirPDF(a),r=this.gerarNomeArquivo(t);o&&(n.save(r),console.log("\u2705 PDF baixado:",r));const i=(n.output("arraybuffer").byteLength/1024).toFixed(2);return console.log("\ud83d\udcca Tamanho final do PDF: ".concat(i," KB")),{nomeArquivo:r,pdfBlob:n.output("blob"),pdfDataUri:n.output("datauristring"),tamanhoKB:i,success:!0}}catch(e){throw console.error("\u274c Erro ao gerar PDF:",e),e}}async comprimirImagem(t){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:800,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.7,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Promise((n,r)=>{const i=new Image;i.crossOrigin="anonymous",i.onload=function(){try{const t=document.createElement("canvas"),r=t.getContext("2d");let s,c,{width:l,height:d}=i;l>o&&(d=d*o/l,l=o),t.width=l,t.height=d,a||(r.fillStyle="white",r.fillRect(0,0,l,d)),r.drawImage(i,0,0,l,d),a?(s=t.toDataURL("image/png"),c="PNG",console.log("\ud83d\uddbc\ufe0f Logo redimensionada (PNG transparente): ".concat(l,"x").concat(d))):(s=t.toDataURL("image/jpeg",e),c="JPEG",console.log("\ud83d\uddbc\ufe0f Imagem comprimida (JPEG): ".concat(l,"x").concat(d," (qualidade: ").concat(100*e,"%)"))),n({dataURL:s,width:l,height:d,aspectRatio:l/d,formato:c})}catch(t){r(t)}},i.onerror=()=>r(new Error("Falha ao carregar imagem: ".concat(t))),i.src=t})}async criarLayoutPDF(t,o){const e=[44,62,80],a=[76,175,80],n=[60,60,60];t.setDrawColor(...e),t.setLineWidth(12),t.rect(1,1,208,295,"S");let r=10;r=await this.adicionarCabecalhoComLogo(t,r,e),r=this.adicionarInformacoesClienteCompacto(t,o,r,n),r=this.adicionarPlanoEconomiaCompacto(t,o,r,n),o.ucs&&o.ucs.length>0&&(r=this.adicionarTabelaUCs(t,o.ucs,r,n)),o.ucs&&o.ucs.length>0&&o.tarifaTributos&&(r=this.adicionarEconomia5Anos(t,o,r,n,a)),o.beneficios&&o.beneficios.length>0&&(r=this.adicionarBeneficiosCompactos(t,o.beneficios,r,n)),await this.adicionarRodape(t)}async adicionarCabecalhoComLogo(t,o,e){t.setFillColor(...e),t.rect(0,0,210,18,"F");try{console.log("\ud83d\uddbc\ufe0f Carregando logo (preservando transpar\xeancia)...");const o=await this.comprimirImagem("/Logo.png",200,.8,!0),e=10*o.aspectRatio,a=35,n=Math.min(e,a),r=n/o.aspectRatio;t.addImage(o.dataURL,o.formato,10,4,n,r),console.log("\ud83d\udcd0 Logo adicionada (".concat(o.formato,"): ").concat(n.toFixed(1),"x").concat(r.toFixed(1),"mm"))}catch(a){console.warn("\ud83d\udcdd Usando fallback de texto para logo:",a.message),t.setTextColor(255,255,255),t.setFontSize(10),t.setFont("helvetica","bold"),t.text("AUPUS",15,12)}return t.setTextColor(255,255,255),t.setFontSize(14),t.setFont("helvetica","bold"),t.text("Proje\xe7\xe3o de efici\xeancia econ\xf4mica",60,12),25}adicionarInformacoesClienteCompacto(t,o,e,a){t.setTextColor(...a),t.setFontSize(12),t.setFont("helvetica","bold"),t.text("Cliente",20,e),e+=6,e+=7,t.setFontSize(11),t.setFont("helvetica","normal"),t.setFont("helvetica","bold"),t.setFontSize(10),t.text("Nome:",25,e),t.setFont("helvetica","normal"),t.setFontSize(10),t.text(o.nomeCliente||"",42,e),t.setFont("helvetica","bold"),t.setFontSize(10),t.text("Proposta:",110,e),t.setFont("helvetica","normal"),t.setFontSize(10),t.text(o.numeroProposta||"",133,e),t.setFont("helvetica","bold"),t.setFontSize(10),t.text("Data:",155,e),t.setFont("helvetica","normal"),t.setFontSize(10);const n=o.data?new Date(o.data).toLocaleDateString("pt-BR"):"";return t.text(n,168,e),t.setDrawColor(160,160,160),t.setLineWidth(.5),t.line(20,e+8,190,e+8),e+15}adicionarPlanoEconomiaCompacto(t,o,e,a){t.setTextColor(...a),t.setFontSize(12),t.setFont("helvetica","bold"),t.text("Plano Economia",20,e),e+=6,e+=6;const n=Math.round(100*(o.descontoTarifa||.2));return t.setFont("helvetica","bold"),t.setTextColor(...a),t.setFontSize(10),t.text("Economia Esperada:",25,e),t.setTextColor(76,175,80),t.setFontSize(20),t.text("".concat(n,"%"),73,e),t.setTextColor(...a),t.setFontSize(10),t.text("Fidelidade:",120,e),t.setTextColor(255,0,0),t.setFont("helvetica","bold"),t.text("N\xc3O",150,e),t.setTextColor(...a),t.setDrawColor(160,160,160),t.setLineWidth(.5),t.line(20,e+8,190,e+8),e+15}adicionarTabelaUCs(t,o,e,a){t.setTextColor(...a),t.setFontSize(12),t.setFont("helvetica","bold"),t.text("Unidades Consumidoras",20,e),e+=6;const n=o.slice(0,10);t.setFillColor(70,100,130),t.rect(20,e,170,10,"F"),t.setFontSize(8),t.setFont("helvetica","bold"),t.setTextColor(255,255,255),t.text("Nome",22,e+3),t.text("Consumo",55,e+3),t.text("Sem",85,e+3),t.text("Com",110,e+3),t.text("Taxa",135,e+3),t.text("Economia",155,e+3),t.text("Economia",175,e+3),t.text("",22,e+7),t.text("",55,e+7),t.text("Assinatura",85,e+7),t.text("Assinatura",110,e+7),t.text("Fixa",135,e+7),t.text("Mensal",155,e+7),t.text("Anual",175,e+7),t.setTextColor(...a),e+=10;return t.setFontSize(8.5),t.setFont("helvetica","normal"),n.forEach((o,a)=>{a%2===1&&(t.setFillColor(248,248,248),t.rect(20,e,170,4,"F"));const n=parseFloat(o.consumo)||0,r=.8*n,i=.8*n*.2,s=12*i,c=.8*n*.8,l=(t=>{switch(null===t||void 0===t?void 0:t.toUpperCase()){case"TRIF\xc1SICA":case"TRIFASICA":return 112;case"BIF\xc1SICA":case"BIFASICA":return 62;default:return 42}})(o.ligacao),d=(o.apelido||"UC ".concat(a+1)).substring(0,12);t.text(d,22,e+3),t.text("".concat(n.toFixed(0)," kWh"),55,e+3),t.text("R$ ".concat(r.toFixed(0)),85,e+3),t.text("R$ ".concat(c.toFixed(0)),110,e+3),t.text("R$ ".concat(l),135,e+3),t.text("R$ ".concat(i.toFixed(0)),155,e+3),t.text("R$ ".concat(s.toFixed(0)),175,e+3),e+=4}),o.length>10&&(t.setFontSize(6),t.setTextColor(180,0,0),t.text("+ ".concat(o.length-10," unidades adicionais"),22,e+2),e+=4),t.setDrawColor(160,160,160),t.setLineWidth(.5),t.line(20,e+8,190,e+8),e+15}calcularEconomia5Anos(t,o,e,a){const n=parseFloat(t.consumo)||0,r=parseFloat(o)||.8,i=parseFloat(e)||.2,s=parseFloat(a)||.02;if(0===n||0===r)return Array(5).fill(0);const c=[];let l=12*(n*r*i);for(let d=1;d<=5;d++)c.push(l),l*=1+s;return c}calcularEconomiaConsolidada(t,o,e,a){const n=Array(5).fill(0);return t.forEach(t=>{this.calcularEconomia5Anos(t,o,e,a).forEach((t,o)=>{n[o]+=t})}),{economiasPorAno:n,economiaTotal:n.reduce((t,o)=>t+o,0)}}adicionarEconomia5Anos(t,o,e,a,n){if(!o.ucs||0===o.ucs.length||!o.tarifaTributos)return e;const r=this.calcularEconomiaConsolidada(o.ucs,o.tarifaTributos,o.descontoTarifa,o.inflacao);t.setTextColor(...a),t.setFontSize(12),t.setFont("helvetica","bold"),t.text("Economia nos pr\xf3ximos cinco anos",20,e);const i={x:20,y:e+=6,largura:170,altura:50},s=Math.max(...r.economiasPorAno),c=i.altura-15,l=i.x+15;t.setDrawColor(240,240,240),t.setFillColor(250,250,250),t.rect(i.x,i.y,i.largura,i.altura,"F"),r.economiasPorAno.forEach((o,e)=>{const n=s>0?o/s*c:0,r=l+30*e,d=i.y+i.altura-10-n;t.setFillColor(44,62,80),t.rect(r,d,25,n,"F"),t.setDrawColor(30,50,70),t.rect(r,d,25,n,"S"),t.setTextColor(...a),t.setFontSize(10),t.setFont("helvetica","bold");const m="Ano ".concat(e+1),u=r+(25-t.getTextWidth(m))/2;if(t.text(m,u,i.y+i.altura-3),n>8){t.setFontSize(8),t.setTextColor(255,255,255),t.setFont("helvetica","bold");const e=o.toLocaleString("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0,maximumFractionDigits:0}),a=r+(25-t.getTextWidth(e))/2;t.text(e,a,d+6)}}),e=i.y+i.altura+10,t.setTextColor(...n),t.setFontSize(11),t.setFont("helvetica","bold");const d=r.economiaTotal.toLocaleString("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0,maximumFractionDigits:0});return t.text("Economia Total: ".concat(d),20,e),t.setDrawColor(160,160,160),t.setLineWidth(.5),t.line(20,e+8,190,e+8),e+15}adicionarBeneficiosCompactos(t,o,e,a){if(!o||0===o.length)return e;t.setTextColor(...a),t.setFontSize(12),t.setFont("helvetica","bold"),t.text("Informa\xe7\xf5es e Benef\xedcios",20,e),e+=6;const n=o.slice(0,10);let r=9;return o.length>8&&(r=7),o.length>12&&(r=6),t.setFontSize(r),t.setFont("helvetica","normal"),n.forEach((o,a)=>{const n="".concat(o.numero||a+1,".")+" "+(o.texto||o.toString());t.splitTextToSize(n,170).forEach(o=>{e>270||(t.text(o,25,e),e+=4)}),e+=1}),o.length>10&&(t.setFontSize(7),t.setTextColor(180,0,0),t.text("+ ".concat(o.length-10," benef\xedcios adicionais"),25,e),e+=3),e+5}async adicionarRodape(t){const o=t.internal.getNumberOfPages();for(let a=1;a<=o;a++){t.setPage(a),t.setFontSize(8),t.setTextColor(0,0,0),t.setFont("helvetica","normal"),t.setTextColor(0,0,0),t.setFontSize(8);const n=15;let r=277;t.text("*  www.aupusenergia.com.br",n,r),r+=3,t.text("@ smart@aupusenergia.com.br",n,r),r+=3,t.text("#  (62) 9 9654-7888",n,r);try{console.log("\ud83d\uddbc\ufe0f Carregando slogan...");const o=await this.comprimirImagem("/Frase_interligando.png",400,.7,!1),e=10*o.aspectRatio,a=100,n=Math.min(e,a),r=n/o.aspectRatio,i=(210-n)/2;t.addImage(o.dataURL,o.formato,i,277,n,r),console.log("\u2705 Slogan adicionado (".concat(o.formato,") ao PDF!"))}catch(e){console.warn("\ud83d\udcdd Usando fallback de texto para slogan:",e.message),t.setFont("times","italic"),t.setFontSize(11),t.setTextColor(76,175,80),t.text("Interligando voc\xea com o futuro!",75,285)}try{console.log("\ud83c\udf0a Carregando onda...");const o=await this.comprimirImagem("/Onda.png",150,.6,!1),e=12*o.aspectRatio,a=Math.min(e,30),n=a/o.aspectRatio,r=210-a-8;t.addImage(o.dataURL,o.formato,r,275,a,n),console.log("\u2705 Imagem onda adicionada (".concat(o.formato,") ao PDF!"))}catch(e){console.warn("\ud83d\udcdd Usando fallback para pagina\xe7\xe3o:",e.message),t.setFont("helvetica","normal"),t.setTextColor(0,0,0),t.text("P\xe1gina ".concat(a," de ").concat(o),170,285)}}}gerarNomeArquivo(t){var o,e;const a=(null===(o=t.numeroProposta)||void 0===o?void 0:o.replace(/[/\\]/g,"_"))||"Proposta",n=(null===(e=t.nomeCliente)||void 0===e?void 0:e.replace(/[^a-zA-Z0-9]/g,"_"))||"Cliente",r=(new Date).toISOString().slice(0,10);return"".concat(a,"_").concat(n,"_").concat(r,".pdf")}formatarDadosParaPDF(t){return{numeroProposta:t.numero_proposta||t.numeroProposta,nomeCliente:t.nome_cliente||t.nomeCliente,consultor:t.consultor,data:t.data_proposta||t.data,descontoTarifa:parseFloat(t.desconto_tarifa||t.descontoTarifa)||.2,descontoBandeira:parseFloat(t.desconto_bandeira||t.descontoBandeira)||.2,tarifaTributos:parseFloat(t.tarifa_tributos||t.tarifaTributos)||.8,inflacao:parseFloat(t.inflacao)||.02,observacoes:t.observacoes||"",ucs:this.formatarUCs(t.unidades_consumidoras||t.ucs||[]),beneficios:this.formatarBeneficios(t.beneficios||[])}}formatarUCs(t){if("string"===typeof t)try{t=JSON.parse(t)}catch(o){return[]}return Array.isArray(t)?t.map(t=>({apelido:t.apelido||t.numero_unidade||"UC",numeroUC:t.numero_unidade||t.numeroUC||"",ligacao:t.ligacao||t.tipo_ligacao||"Monof\xe1sica",consumo:t.consumo_medio||t.consumo||0})):[]}formatarBeneficios(t){if("string"===typeof t)try{t=JSON.parse(t)}catch(o){return[]}return Array.isArray(t)?t.map((t,o)=>({numero:t.numero||o+1,texto:t.texto||t.toString()})):[]}static async baixarPDF(t){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const e=new a;return await e.gerarPDF(t,o)}static async baixarPDFDeProposta(t){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const e=new a,n=e.formatarDadosParaPDF(t);return await e.gerarPDF(n,o)}}const n=a;"undefined"!==typeof window&&(window.PDFGenerator=a)}}]);